<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wordcloud</title>
    <script src="./js/d3.v5.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/holtzy/D3-graph-gallery@master/LIB/d3.layout.cloud.js"></script>
</head>

<body>
    <div id="data"></div>
    <div id="btn"
        style="margin-left: 220px; width: 100px; height: 70px; background-color: gray; line-height: 70px; text-align: center;">
        change</div>
    <script>
        // // list of words...
        d3.json('./data/FakeData.json').then(function (result) {
            console.log(result);
            let name_collect = {};
            for (let i = 0; i < result.length; i++) {
                let stu_obj = result[i];
                let stu_academy = stu_obj.学院;
                let stu_name = stu_obj.姓名;
                stu_name = stu_name.substring(0, 1);//取姓氏

                if (!(stu_academy in name_collect)) {//创建数据中的学院
                    name_collect[stu_academy] = {};
                }
                // console.log(typeof name_collect[stu_academy])

                if (stu_name in name_collect[stu_academy]) {
                    name_collect[stu_academy][stu_name] += 1;
                }
                else {
                    name_collect[stu_academy][stu_name] = 1;
                }
            }
            console.log(name_collect);

            let academy_keys = Object.keys(name_collect);//所有学院
            console.log(academy_keys);
            console.log(typeof academy_keys);
            let name_data = [];
            for (let i = 0; i < academy_keys.length; i++) {

                let keys = Object.keys(name_collect[academy_keys[i]]);//获取学院的姓
                name_data[i] = [];
                for (let j = 0; j < keys.length; j++) {
                    let value = name_collect[academy_keys[i]][keys[j]];
                    // console.log(value);
                    // console.log(keys[j]);
                    name_data[i][j] = {};
                    name_data[i][j]["word"] = keys[j];
                    name_data[i][j]["size"] = value;
                }
            }

            console.log(name_data)

            var margin = { top: 10, right: 10, bottom: 60, left: 10 },
                width = 550 - margin.left - margin.right,
                height = 600 - margin.top - margin.bottom;

            // append the svg object to the body of the page

            let num = 0;
            let btn = document.getElementById("btn");

            console.log(academy_keys.length);

            btn.onclick = function () {
                if (num+1 == academy_keys.length) {
                    num = -1
                }
                num += 1;
                console.log(num);
                d3.selectAll('svg').remove();
                draw_cloud(name_data, academy_keys, num);
            }

            draw_cloud(name_data, academy_keys, num);
        });


        let draw_cloud = function (input, aca, num) {
            // List of words
            // var myWords = [{word: "Running", size: "10"}, {word: "Surfing", size: "20"}, {word: "Climbing", size: "50"}, {word: "Kiting", size: "30"}, {word: "Sailing", size: "20"}, {word: "Snowboarding", size: "60"} ]
            var myWords = input[num];


            // set the dimensions and margins of the graph
            var margin = { top: 10, right: 10, bottom: 60, left: 10 },
                width = 550 - margin.left - margin.right,
                height = 550 - margin.top - margin.bottom;

            // append the svg object to the body of the page
            var svg = d3.select("#data")
                .append("svg")
                .attr("id", "output")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .append("g")
                .attr("transform",
                    "translate(" + margin.left + "," + margin.top + ")");

            // Constructs a new cloud layout instance. It run an algorithm to find the position of words that suits your requirements
            // Wordcloud features that are different from one word to the other must be here
            var layout = d3.layout.cloud()
                .size([width, height])
                .words(myWords.map(function (d) { return { text: d.word, size: d.size }; }))
                .padding(5)        //space between words
                // .rotate(function() { return ~~(Math.random() * 2) * 90; })
                .fontSize(function (d) { return d.size; })      // font size of words
                .on("end", draw);
            layout.start();

            // This function takes the output of 'layout' above and draw the words
            // Wordcloud features that are THE SAME from one word to the other can be here
            function draw(words) {
                svg
                    .append("g")
                    .attr("transform", "translate(" + layout.size()[0] / 2 + "," + layout.size()[1] / 2 + ")")
                    .selectAll("text")
                    .data(words)
                    .enter().append("text")
                    .style("font-size", function (d) { return d.size; })
                    .style("fill", "#69b3a2")
                    .attr("text-anchor", "middle")
                    .style("font-family", "Impact")
                    .attr("transform", function (d) {
                        // return "translate(" + [d.x, d.y] + ")rotate(" + d.rotate + ")";
                        return "translate(" + [d.x, d.y] + ")";
                    })
                    .text(function (d) { return d.text; });
            }


            let aca_name = svg.append('text').text([aca[num]]).attr('fill', 'black')
                .attr('x', 250)
                .attr('y', 500)
                .attr('text-anchor', 'middle')
                .style('font-size', '20px')

        }

    </script>

</html>